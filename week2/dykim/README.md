## 실습
```js
// 에러 로그 -> traceID -> MythRequest API(Post, 엔드포인트) -> MythServer
let name = req.body.name
    if (process.env.ALWAYS_SUCCEED != "true" && Math.random() < 0.1) {
        name = null
}
```

```yaml
# Docker-compose.yaml
- ALWAYS_SUCCEED=true
```

## 개념
![Blank diagram - Color](https://github.com/user-attachments/assets/852aad47-301e-4048-8a54-dec806fbdb38)

**모니터링**   
어떤 대상을 감시, 관찰한다는 의미이다. 주요 목적으로는 지속적인 감시, 감찰을 통해 대상의 상태나 가용성, 변화 등을 확인하고 장애에 대비하는 것이다.

**o11y**    
시스템 외부에서 시스템의 내부 동작을 모르더라도 시스템의 내부 상태를 쉽게 이해하기 위한 능력을 의미한다. 더 나아가 아직 알려지지 않은 문제에 쉽게 해결하고 처리할수 있도록 한다. 시스템에 대한 맥락에서 텔레메트리 데이터(메트릭, 로그, 트레이스)를 통해 시스템 내부 상태를 쉽게 이해할수 있도록 한다.

**모니터링과 o11y 차이**
|   항목         | 모니터링 | 옵저버빌리티 |
|----------------|-------------------|----------------------|
| 대응 방식       | 사후 대응         | 선제적 대응 |
| 문제 해결 방법  | 상황별 예측적 대응  | 추측이 아닌 데이터 중심 |
| 문제 접근 방식  |  무엇 + 언제       | 무엇 + 언제 + 왜 + 어떻게 |
| 문제 유형       | 예상된 문제 | 알려지지 않은 문제|
| 데이터 관리     | 데이터 사일로(분산되어 저장) | 데이터를 한 곳에서 통합 |
| 데이터 수집 방식| 샘플링 기반 | 모든 것을 계측하여 분석 |

**메트릭**    
인프라 혹은 서비스 성능과 같은 상태를 나타내는 지표이다. 주로 시계열 데이터로 표현하며 cpu 사용량, 메모리 사용량과 같은 수치를 표현한다.  

**로그**  
시스템 또는 애플리케이션에서 발생하는 이벤트

**트레이스**  
애플리케이션을 구성하는 다양한 서비스 간에 요청 또는 진행 상황을 제공한다. 실패 발생 위치와 서비스 흐름에서 성능 저하에 영향을 주는 요소를 찾아낼 수 있게 해준다.

**otel**  
메트릭, 로그와 트레이스같은 원격 측정 데이터를 생성하고 관리하는 것에 목적을 둔 옵저버빌리티 프레임워크(API, SDK)이자 툴킷이다. 원격 측정의 생성, 수집, 관리 및 추출에 중점을 두고 벤더 및 도구에 구애받지 않는다. 수집된 데이터에 대한 백엔드 또는 시각화는 다른 도구가 담당한다.

**otel의 필요성**
- 원격 측정 데이터 형식의 표준
- 단일 조합의 API와 컨벤션
- 벤더내츄럴

**RED**  
Request(초당 처리되는 요청 수), Error(초당 실패한 요청 개수 4xx, 5xx등), Duration(응답 시간)의 약자로 사용자의 요청을 기준으로 서비스 상태를 모니터링하는 방식을 의미한다. RED는 애플리케이션 사용자의 경험을 중점으로 둔다. 

**RED 이점**
1. 문제를 해결하는데 필요한 인지 부하 감소
2. 사용자 및 기업의 목표에 부합

**RED 단점**
1. 요청 기반 APP를 주요 대상으로 하여 배치 프로세싱 또는 스트리밍 서비스에는 부적합하다.
2. 서비스 장애를 파악하기 어렵다. 

## 배운 점
1. 시스템마다 일관된 로그 포맷의 중요하다.
2. 라벨링의 중요성. 라벨을 어떻게 구성하냐에 따라서 시스템에 대한 확장성과 발생되는 문제 탐색 그리고 스토리지 저장에 따른 비용이 줄일 수 있기 때문이다.

## 궁금한 점
1. 알람을 설정한다면 어떤 서비스를 어떤 조건으로 설정해야 할까? 
2. o11y와 모니터링의 데이터 관리, 수집 방식 차이에 대해서 이해가 안간다.

[Google SRE Book](https://sre.google/books/)   
[New Relic o11y white paper](https://newrelic.com/sites/default/files/2023-04/new-relic-observability-priority-white-paper-2023-02-13_kor.pdf)  
